<!DOCTYPE html>
<html lang="th">

<head>
  <meta charset="UTF-8">
  <title>Dashboard ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</title>
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
</head>

<body class="bg-gray-100">

  <div class="flex min-h-screen">
    <!-- Side Nav -->
    <aside class="w-64 bg-gray-800 p-6">
      <h1 class="text-white text-xl font-bold mb-6">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°‡∏Ñ‡∏∑‡∏ô ‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°</h1>
      <nav class="space-y-4">
        <a href="#" class="block bg-gray-700 hover:bg-gray-600 text-white py-2 px-4 rounded">‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
        <a href="#" class="block bg-gray-700 hover:bg-gray-600 text-white py-2 px-4 rounded">‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</a>
        <a href="#" class="block bg-gray-700 hover:bg-gray-600 text-white py-2 px-4 rounded">‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</a>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 p-6">
      <div class="bg-white p-6 rounded-lg shadow-sm">

        <!-- Summary Boxes -->
        <div id="summaryBoxes" class="grid grid-cols-2 sm:grid-cols-4 gap-4 mb-8"></div>

        <!-- ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Ñ‡∏∑‡∏ô -->
        <h2 class="text-2xl font-bold mb-4">‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Ñ‡∏∑‡∏ô</h2>
        <div id="borrowCards" class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-10"></div>

        <!-- Filter & Table Wrapper -->
        <div class="border-2 border-blue-500 rounded-lg p-4">
          <div class="mb-4">
            <h2 class="text-lg font-semibold">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏°</h2>
          </div>
          <!-- Filters -->
          <div class="grid grid-cols-1 sm:grid-cols-4 gap-4 mb-4">
            <div>
              <label class="block text-sm">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏ã‡πà‡∏≠‡∏°</label>
              <input id="filterDate" type="date" class="border p-1 rounded w-full">
            </div>
            <div>
              <label class="block text-sm">‡∏£‡∏´‡∏±‡∏™</label>
              <input id="filterId" type="text" placeholder="‡∏£‡∏´‡∏±‡∏™" class="border p-1 rounded w-full">
            </div>
            <div>
              <label class="block text-sm">‡∏ä‡∏∑‡πà‡∏≠</label>
              <input id="filterName" type="text" placeholder="‡∏ä‡∏∑‡πà‡∏≠" class="border p-1 rounded w-full">
            </div>
            <div>
              <label class="block text-sm">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</label>
              <input id="filterStatus" type="text" placeholder="‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞" class="border p-1 rounded w-full">
            </div>
          </div>

          <!-- Table -->
          <table class="min-w-full table-fixed rounded-lg overflow-hidden">
            <thead class="bg-black">
              <tr>
                <th class="w-24 py-2 px-4 text-left text-white text-sm">‡∏£‡∏´‡∏±‡∏™</th>
                <th class="w-36 py-2 px-4 text-left text-white text-sm">‡∏ä‡∏∑‡πà‡∏≠</th>
                <th class="w-48 py-2 px-4 text-left text-white text-sm">‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠</th>
                <th class="w-64 py-2 px-4 text-left text-white text-sm">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</th>
                <th class="w-32 py-2 px-4 text-left text-white text-sm">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                <th class="w-32 py-2 px-4 text-left text-white text-sm">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
              </tr>
            </thead>
            <tbody id="repairList" class="bg-white divide-y divide-gray-200 text-sm"></tbody>
          </table>

          <!-- Footer: Rows-per-page & Pagination -->
          <div class="flex justify-between items-center mt-4">
            <!-- ‡πÅ‡∏™‡∏î‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÅ‡∏ñ‡∏ß‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πâ‡∏≤ -->
            <div class="flex items-center">
              <label for="rowsPerPage" class="mr-2">‡πÅ‡∏™‡∏î‡∏á</label>
              <select id="rowsPerPage" class="border px-2 py-1 rounded mr-2">
                <option value="15">15</option>
                <option value="50">50</option>
                <option value="100">100</option>
              </select>
              <span>‡πÅ‡∏ñ‡∏ß‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πâ‡∏≤</span>
            </div>
            <!-- ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏•‡∏Ç‡∏´‡∏ô‡πâ‡∏≤ -->
            <div id="pagination" class="flex space-x-2"></div>
          </div>

        </div>

        <!-- Modal -->
        <div id="modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
          <div class="bg-white rounded-lg w-11/12 md:w-1/2 p-6 relative">
            <button id="closeModal"
              class="absolute top-2 right-2 text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
            <div id="modalContent"></div>
          </div>
        </div>

      </div>
    </main>
  </div>

  <script>
    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyBOCnA32ir0bHOlfIOvJ_ltAj65A5DJSlk",
      authDomain: "register-58eea.firebaseapp.com",
      databaseURL: "https://register-58eea-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "register-58eea",
      storageBucket: "register-58eea.firebasestorage.app",
      messagingSenderId: "629204385342",
      appId: "1:629204385342:web:1d9c20a8b3f57269e09b6f",
      measurementId: "G-FFLKXCZE64"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // State
    let devicesGrouped = {};
    let reportsData = [];
    let currentPage = 1;
    let rowsPerPage = 15;
    let countLoaners = 0, countBorrowedItems = 0, countReported = 0, countSuccess = 0;

    // Utils
    function formatDate(iso) {
      if (!iso) return '-';
      const d = new Date(iso);
      const dd = String(d.getDate()).padStart(2, '0');
      const mm = String(d.getMonth() + 1).padStart(2, '0');
      const yyyy = d.getFullYear();
      return `${dd}-${mm}-${yyyy}`;
    }
    function getStatusClass(s) {
      if (s === "‡∏£‡∏≠‡∏ã‡πà‡∏≠‡∏°") return "bg-red-500 text-white";
      if (s === "‡∏™‡πà‡∏á‡∏ã‡πà‡∏≠‡∏°") return "bg-yellow-300 text-black";
      if (s === "‡∏ã‡πà‡∏≠‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à") return "bg-green-500 text-white";
      return "bg-gray-300 text-black";
    }

    // Summary boxes
    const summaryBoxes = document.getElementById("summaryBoxes");
    function updateSummaryBoxes() {
      summaryBoxes.innerHTML = `
        <div class="bg-white border border-gray-300 rounded-lg p-4 text-center">
          <div class="text-2xl font-bold">${countLoaners}</div>
          <div class="text-sm">‡∏ú‡∏π‡πâ‡∏¢‡∏∑‡∏°</div>
        </div>
        <div class="bg-white border border-gray-300 rounded-lg p-4 text-center">
          <div class="text-2xl font-bold">${countBorrowedItems}</div>
          <div class="text-sm">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏Ñ‡∏∑‡∏ô</div>
          <button onclick="notifyAllNotReturned()" class="mt-2 text-xs bg-blue-600 text-white px-2 py-1 rounded">‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</button>
        </div>
        <div class="bg-white border border-gray-300 rounded-lg p-4 text-center">
          <div class="text-2xl font-bold">${countReported}</div>
          <div class="text-sm">‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°</div>
        </div>
        <div class="bg-white border border-gray-300 rounded-lg p-4 text-center">
          <div class="text-2xl font-bold">${countSuccess}</div>
          <div class="text-sm">‡∏ã‡πà‡∏≠‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</div>
        </div>
      `;
    }

    // Notify all not-returned
    function notifyAllNotReturned() {
      Object.entries(devicesGrouped).forEach(([uid, u]) => {
        const list = u.items.map(i => `${i.id} ${i.name}`).join(', ');
        notifyLine(uid, u.user, list);
      });
    }

    // Fetch borrowed devices
    // ======= ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà db.ref("devices").once(...) ‡∏î‡πâ‡∏ß‡∏¢ on() =======
    db.ref("devices").on("value", snapshot => {
      // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤
      devicesGrouped = {};
      countLoaners = 0;
      countBorrowedItems = 0;
      const container = document.getElementById("borrowCards");
      container.innerHTML = "";

      // ‡∏™‡∏£‡πâ‡∏≤‡∏á grouped ‡∏ï‡∏≤‡∏°‡∏ú‡∏π‡πâ‡∏¢‡∏∑‡∏°‡πÉ‡∏´‡∏°‡πà
      snapshot.forEach(child => {
        const d = child.val();
        if (d.status === "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô" && d.lastUserId) {
          if (!devicesGrouped[d.lastUserId]) {
            devicesGrouped[d.lastUserId] = {
              user: d.lastUser || "‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏",
              items: []
            };
          }
          devicesGrouped[d.lastUserId].items.push({
            id: d.deviceId,
            name: d.deviceName
          });
        }
      });

      // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏™‡∏£‡∏∏‡∏õ
      countLoaners = Object.keys(devicesGrouped).length;
      countBorrowedItems = Object.values(devicesGrouped)
        .reduce((sum, u) => sum + u.items.length, 0);

      // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÉ‡∏´‡∏°‡πà
      Object.entries(devicesGrouped).forEach(([uid, u]) => {
        const list = u.items.map(i => `${i.id} ${i.name}`).join(', ');
        const card = document.createElement("div");
        card.className = "border border-gray-300 rounded-lg p-4 bg-white";
        card.innerHTML = `
      <div class="flex justify-between items-center">
        <h3 class="font-semibold text-lg">üë§ ${u.user}</h3>
        <button
          onclick="notifyLine('${uid}','${u.user}','${list}')"
          class="bg-red-500 hover:bg-red-600 text-white text-xs px-3 py-1 rounded-full"
        >‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</button>
      </div>
      <ul class="text-sm mt-2 space-y-1">
        ${u.items.map(i => `<li>‚Ä¢ ${i.id} : ${i.name}</li>`).join('')}
      </ul>
    `;
        container.appendChild(card);
      });

      // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï summary UI
      updateSummaryBoxes();
    });


    // === ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ô‡∏µ‡πâ: ‡πÉ‡∏ä‡πâ on("value") ‡πÅ‡∏ó‡∏ô once() ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÅ‡∏ö‡∏ö real-time ===
    db.ref("repairReports").on("value", snap => {
      reportsData = [];
      countReported = 0;
      countSuccess = 0;

      snap.forEach(child => {
        const r = child.val();
        reportsData.push({ id: child.key, ...r });
        if (r.status === "‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°") countReported++;
        if (r.status === "‡∏ã‡πà‡∏≠‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à") countSuccess++;
      });

      // sort by sendDate desc
      reportsData.sort((a, b) => new Date(b.sendDate) - new Date(a.sendDate));

      updateSummaryBoxes();
      renderTablePage();
    });

    // Filters & pagination
    document.getElementById("rowsPerPage").addEventListener("change", e => {
      rowsPerPage = +e.target.value;
      currentPage = 1;
      renderTablePage();
    });
    ["filterDate", "filterId", "filterName", "filterStatus"].forEach(id => {
      document.getElementById(id).addEventListener("input", () => {
        currentPage = 1;
        renderTablePage();
      });
    });

    function renderTablePage() {
      const fDate = document.getElementById("filterDate").value;
      const fId = document.getElementById("filterId").value.trim();
      const fName = document.getElementById("filterName").value.trim();
      const fStatus = document.getElementById("filterStatus").value.trim();

      const filtered = reportsData.filter(r => {
        if (fDate && r.sendDate !== fDate) return false;
        if (fId && !r.deviceId.includes(fId)) return false;
        if (fName && !r.deviceName.includes(fName)) return false;
        if (fStatus && !r.status.includes(fStatus)) return false;
        return true;
      });

      const tbody = document.getElementById("repairList");
      tbody.innerHTML = "";
      const start = (currentPage - 1) * rowsPerPage;
      const pageData = filtered.slice(start, start + rowsPerPage);
      pageData.forEach(r => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td class="py-2 px-4">${r.deviceId}</td>
          <td class="py-2 px-4">${r.deviceName}</td>
          <td class="py-2 px-4">${r.title}</td>
          <td class="py-2 px-4">${r.details}</td>
          <td class="py-2 px-4">
            <span class="px-2 py-1 rounded-full ${getStatusClass(r.status)}">${r.status}</span>
          </td>
          <td class="py-2 px-4 space-x-2">
            <button onclick="viewRepair('${r.id}')" class="px-3 py-1 rounded bg-[#7E7AD9] text-white">‡∏î‡∏π</button>
            <button onclick="editRepair('${r.id}')" class="px-3 py-1 rounded bg-[#09054D] text-white">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï</button>
          </td>
        `;
        tbody.appendChild(tr);
      });

      const totalPages = Math.ceil(filtered.length / rowsPerPage);
      const pg = document.getElementById("pagination");
      pg.innerHTML = "";
      for (let i = 1; i <= totalPages; i++) {
        const btn = document.createElement("button");
        btn.textContent = i;
        btn.className = `px-3 py-1 rounded ${i === currentPage ? 'bg-black text-white' : 'bg-gray-300 text-black'}`;
        btn.onclick = () => { currentPage = i; renderTablePage(); };
        pg.appendChild(btn);
      }
    }

    // Modal handlers & view/edit (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°)
    const modal = document.getElementById("modal");
    const modalContent = document.getElementById("modalContent");
    const closeModal = document.getElementById("closeModal");
    closeModal.addEventListener("click", () => {
      modal.classList.add("hidden");
      document.body.classList.remove("overflow-hidden");
    });
    window.addEventListener("click", e => {
      if (e.target === modal) {
        modal.classList.add("hidden");
        document.body.classList.remove("overflow-hidden");
      }
    });

    function viewRepair(id) {
      db.ref("repairReports/" + id).once("value").then(snap => {
        const r = snap.val();
        modalContent.innerHTML = `
          <h2 class="text-xl font-bold mb-4">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°</h2>
          <p><strong>‡∏£‡∏´‡∏±‡∏™:</strong> ${r.deviceId}</p>
          <p><strong>‡∏ä‡∏∑‡πà‡∏≠:</strong> ${r.deviceName}</p>
          <p><strong>‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠:</strong> ${r.title}</p>
          <p><strong>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î:</strong> ${r.details}</p>
          <p><strong>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</strong> ${r.status}</p>
          <p><strong>‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö:</strong> ${r.responsible || "-"}</p>
          <p><strong>‡∏™‡πà‡∏á‡∏ã‡πà‡∏≠‡∏°‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</strong> ${formatDate(r.sendDate)}</p>
          <p><strong>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà:</strong> ${r.location || "-"}</p>
          <p><strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏Ñ‡∏∑‡∏ô:</strong> ${r.returnDate ? formatDate(r.returnDate) : "-"}</p>
          <p><strong>‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:</strong> ${r.solution || "-"}</p>
          <p><strong>‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢:</strong> ${r.cost || "-"}</p>
          <p><strong>‡∏£‡∏π‡∏õ‡∏´‡∏•‡∏±‡∏á‡∏ã‡πà‡∏≠‡∏°:</strong><br>
            ${r.imageAfter ? `<img src="${r.imageAfter}" class="mt-2 max-w-full rounded">` : "‡πÑ‡∏°‡πà‡∏°‡∏µ"}
          </p>
        `;
        modal.classList.remove("hidden");
        document.body.classList.add("overflow-hidden");
      });
    }

    function editRepair(id) {
      db.ref("repairReports/" + id).once("value").then(snap => {
        const d = snap.val();
        modalContent.innerHTML = `
          <h2 class="text-xl font-bold mb-4">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°</h2>
          <form id="updateForm" class="space-y-3">
            <input type="hidden" id="repairId" value="${id}">
            <input id="status" value="${d.status || ''}" placeholder="‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞" class="w-full p-2 border rounded">
            <input id="responsible" value="${d.responsible || ''}" placeholder="‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö" class="w-full p-2 border rounded">
            <input id="sendDate" value="${d.sendDate || ''}" type="date" class="w-full p-2 border rounded">
            <input id="location" value="${d.location || ''}" placeholder="‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà" class="w-full p-2 border rounded">
            <input id="returnDate" value="${d.returnDate || ''}" type="date" class="w-full p-2 border rounded">
            <textarea id="solution" class="w-full p-2 border rounded" placeholder="‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç">${d.solution || ''}</textarea>
            <input id="cost" value="${d.cost || ''}" placeholder="‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢" class="w-full p-2 border rounded">
            <input id="imageAfter" value="${d.imageAfter || ''}" placeholder="URL ‡∏£‡∏π‡∏õ‡∏´‡∏•‡∏±‡∏á‡∏ã‡πà‡∏≠‡∏°" class="w-full p-2 border rounded">
            <button type="submit" class="bg-green-500 text-white px-4 py-2 rounded">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
          </form>
        `;
        modal.classList.remove("hidden");
        document.body.classList.add("overflow-hidden");
        document.getElementById("updateForm").addEventListener("submit", e => {
          e.preventDefault();
          const id2 = document.getElementById("repairId").value;
          db.ref("repairReports/" + id2).update({
            status: document.getElementById("status").value,
            responsible: document.getElementById("responsible").value,
            sendDate: document.getElementById("sendDate").value,
            location: document.getElementById("location").value,
            returnDate: document.getElementById("returnDate").value,
            solution: document.getElementById("solution").value,
            cost: document.getElementById("cost").value,
            imageAfter: document.getElementById("imageAfter").value
          }).then(() => {
            alert("‚úÖ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
            modal.classList.add("hidden");
            document.body.classList.remove("overflow-hidden");
            // No need to manually call renderTablePage(); on() listener will update automatically
          });
        });
      });
    }

    // Notify via LINE OA
    function notifyLine(userId, userName, list) {
      const message = `üì¶ ‡∏Ñ‡∏∏‡∏ì ${userName} ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Ñ‡∏∑‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå: ${list}`;
      fetch("https://script.google.com/macros/s/AKfycbxgGncjm0mJlbxYgQh5z4kvfbfefUniF_VKA_gcItazeNS0B5H56CyI5UiBDJCvAnFk_w/exec", {
        method: "POST",
        mode: "no-cors",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ userId, message })
      });
    }
  </script>

</body>

</html>
